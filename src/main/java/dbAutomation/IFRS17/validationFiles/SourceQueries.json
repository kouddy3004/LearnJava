{
  "PolicyActuals": "select distinct stg.*,'1' as cf_source_type,'-1' as scenario_no,'-1' as investment_identifier,'0' as risk_expiry_status\nfrom(\n(\nselect sl.v_account_number as policy_id,to_char(sl.fic_mis_date) as as_of_date,to_char(sl.d_transaction_date) as CASH_FLOW_DATE,\nsl.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sl.v_coverage_id\nand dim.d_record_start_date <= sl.fic_mis_date and dim.d_record_end_date >= sl.fic_mis_date) as coverage_type,\n(select LISTAGG(amounts,',') within group (order by dim_attribute_numeric_member)\nfrom(select distinct attr.dim_attribute_numeric_member,sum(COALESCE(sta.n_txn_amt_ncy,sta.n_txn_amt)) as amounts\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin Stg_Life_Ins_Policy_Txns sta  on sta.V_POLICY_TXN_TYPE_CODE =to_char(tl.transaction_type_id) \nwhere sta.v_account_number=sl.v_account_number and sta.fic_mis_date=sl.fic_mis_date\ngroup by attr.dim_attribute_numeric_member)\n) as amount,\n(select LISTAGG('FE_'||to_char(dim_attribute_numeric_member),',') within group (order by dim_attribute_numeric_member)\nfrom(select distinct attr.dim_attribute_numeric_member\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin Stg_Life_Ins_Policy_Txns sta  on sta.V_POLICY_TXN_TYPE_CODE =to_char(tl.transaction_type_id)))\nas cashflowColumn\nfrom Stg_Life_Ins_Policy_Txns sl\n)\nunion\n(\nselect he.v_account_number as policy_id,to_char(he.fic_mis_date) as as_of_date,to_char(he.d_transaction_date) as CASH_FLOW_DATE,\nhe.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=he.v_coverage_id\nand dim.d_record_start_date <= he.fic_mis_date and dim.d_record_end_date >= he.fic_mis_date) as coverage_type,\n(select LISTAGG(COALESCE(sta.n_txn_amt_ncy,sta.n_txn_amt),',') WITHIN GROUP (order by sta.V_POLICY_TXN_TYPE_CODE) \nfrom stg_health_ins_policy_txns sta where sta.v_account_number=he.v_account_number and sta.fic_mis_date=he.fic_mis_date\nand sta.V_POLICY_TXN_TYPE_CODE in (select to_char(tl1.transaction_type_id) from dim_transaction_type_attr attr1  \njoin dim_transaction_type_tl tl1 on attr1.transaction_type_id = tl1.transaction_type_id)) as amount,\n(select LISTAGG('FE_'||to_char(attr.dim_attribute_numeric_member),',') within group (order by sta.V_POLICY_TXN_TYPE_CODE)\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_health_ins_policy_txns sta  on sta.V_POLICY_TXN_TYPE_CODE =to_char(tl.transaction_type_id) \nwhere sta.v_account_number=he.v_account_number and sta.fic_mis_date=he.fic_mis_date)\nas cashflowColumn\nfrom stg_health_ins_policy_txns he\n)\nunion\n(\nselect sp.v_account_number as policy_id,to_char(sp.fic_mis_date) as as_of_date,to_char(sp.d_transaction_date) as CASH_FLOW_DATE,\nsp.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sp.v_coverage_id\nand dim.d_record_start_date <= sp.fic_mis_date and dim.d_record_end_date >= sp.fic_mis_date) as coverage_type,\n(select LISTAGG(COALESCE(sta.n_txn_amt_ncy,sta.n_txn_amt),',') WITHIN GROUP (order by sta.V_POLICY_TXN_TYPE_CODE) \nfrom stg_prop_casu_policy_txns sta where sta.v_account_number=sp.v_account_number and sta.fic_mis_date=sp.fic_mis_date\nand sta.V_POLICY_TXN_TYPE_CODE in (select to_char(tl1.transaction_type_id) from dim_transaction_type_attr attr1  \njoin dim_transaction_type_tl tl1 on attr1.transaction_type_id = tl1.transaction_type_id)) as amount,\n(select LISTAGG('FE_'||to_char(attr.dim_attribute_numeric_member),',') within group (order by sta.V_POLICY_TXN_TYPE_CODE)\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_prop_casu_policy_txns sta  on sta.V_POLICY_TXN_TYPE_CODE =to_char(tl.transaction_type_id)\nwhere sta.v_account_number=sp.v_account_number and sta.fic_mis_date=sp.fic_mis_date)\nas cashflowColumn\nfrom stg_prop_casu_policy_txns sp\n)\nunion\n(\nselect sa.v_account_number as policy_id,to_char(sa.fic_mis_date) as as_of_date,to_char(sa.d_transaction_date) as CASH_FLOW_DATE,\nsa.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sa.v_coverage_id\nand dim.d_record_start_date <= sa.fic_mis_date and dim.d_record_end_date >= sa.fic_mis_date) as coverage_type,\n(select LISTAGG(COALESCE(sta.n_txn_amt_ncy,sta.n_txn_amt),',') WITHIN GROUP (order by sta.V_POLICY_TXN_TYPE_CODE) \nfrom stg_annuity_txns sta where sta.v_account_number=sa.v_account_number and sta.fic_mis_date=sa.fic_mis_date\nand sta.V_POLICY_TXN_TYPE_CODE in (select to_char(tl1.transaction_type_id) from dim_transaction_type_attr attr1  \njoin dim_transaction_type_tl tl1 on attr1.transaction_type_id = tl1.transaction_type_id)) as amount,\n(select LISTAGG('FE_'||to_char(attr.dim_attribute_numeric_member),',') within group (order by sta.V_POLICY_TXN_TYPE_CODE)\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_annuity_txns sta  on sta.V_POLICY_TXN_TYPE_CODE =to_char(tl.transaction_type_id)\nwhere sta.v_account_number=sa.v_account_number and sta.fic_mis_date=sa.fic_mis_date)\nas cashflowColumn\nfrom stg_annuity_txns sa\n) \nunion(\nselect sr.v_account_number as policy_id,to_char(sr.fic_mis_date) as as_of_date,to_char(sr.d_txn_date) as CASH_FLOW_DATE,\nsr.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sr.v_coverage_id and dim.d_record_start_date <= sr.fic_mis_date\nand dim.d_record_end_date >= sr.fic_mis_date) as coverage_type,\n(select LISTAGG(COALESCE(sta.n_txn_amt_ncy,sta.n_txn_amt),',') within group (order by sta.V_POLICY_TXN_TYPE_CODE)\nfrom stg_retirement_accounts_txns sta where sta.v_account_number= sr.v_account_number and sta.fic_mis_date= sr.fic_mis_date \nand sta.V_POLICY_TXN_TYPE_CODE in (select to_char(tl1.transaction_type_id) from dim_transaction_type_attr attr1  \njoin dim_transaction_type_tl tl1 on attr1.transaction_type_id = tl1.transaction_type_id)) as amount,\n(select LISTAGG('FE_'||to_char(attr.dim_attribute_numeric_member),',') within group (order by sta.V_POLICY_TXN_TYPE_CODE)\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_retirement_accounts_txns sta  on sta.V_POLICY_TXN_TYPE_CODE =to_char(tl.transaction_type_id)\nwhere sta.v_account_number=sr.v_account_number and sta.fic_mis_date=sr.fic_mis_date)\nas cashflowColumn\nfrom stg_retirement_accounts_txns sr\n)\nunion\n(\nselect cl.v_policy_id as policy_id,to_char(cl.fic_mis_date) as as_of_date,to_char(COALESCE(cl.d_claim_closed_date,cl.d_claim_reclosed_date)) as CASH_FLOW_DATE,\ncl.v_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=cl.v_coverage_id\nand dim.d_record_start_date <= cl.fic_mis_date and dim.d_record_end_date >= cl.fic_mis_date) as coverage_type,\n(\nselect LISTAGG(amounts,',') within group (order by dim_attribute_numeric_member)\nfrom(select distinct attr.dim_attribute_numeric_member,sum(COALESCE(sta.n_tot_settled_amount, sta.n_claim_amount_outstanding)) as amounts\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_claim_details sta  on sta.v_claim_type =to_char(tl.transaction_type_id)\nwhere sta.v_policy_id=cl.v_policy_id and sta.fic_mis_date=cl.fic_mis_date\ngroup by attr.dim_attribute_numeric_member)\n) as amount,\n(\nselect LISTAGG('FE_'||to_char(dim_attribute_numeric_member),',') within group (order by dim_attribute_numeric_member)\nfrom(select distinct attr.dim_attribute_numeric_member\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_claim_details sta  on sta.v_claim_type =to_char(tl.transaction_type_id)\nwhere sta.v_policy_id=cl.v_policy_id and sta.fic_mis_date=cl.fic_mis_date)\n)\nas cashflowColumn\nfrom stg_claim_details cl \n)\nunion\n(\nselect ritxn.v_account_number as policy_id,to_char(ritxn.fic_mis_date) as as_of_date,to_char(ritxn.d_transaction_date) as CASH_FLOW_DATE,\nritxn.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=ritxn.v_coverage_id and dim.d_record_start_date <= ritxn.fic_mis_date\nand dim.d_record_end_date >= ritxn.fic_mis_date) as coverage_type,\n(select LISTAGG(COALESCE(sta.n_txn_amt_ncy,sta.n_txn_amt),',') within group (order by sta.V_POLICY_TXN_TYPE_CODE)\nfrom stg_reinsurance_issued_txns sta where sta.v_account_number= ritxn.v_account_number and sta.fic_mis_date= ritxn.fic_mis_date \nand sta.V_POLICY_TXN_TYPE_CODE in (select to_char(tl1.transaction_type_id) from dim_transaction_type_attr attr1  \njoin dim_transaction_type_tl tl1 on attr1.transaction_type_id = tl1.transaction_type_id)) as amount,\n(select LISTAGG('FE_'||to_char(attr.dim_attribute_numeric_member),',') within group (order by sta.V_POLICY_TXN_TYPE_CODE)\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_tl tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_reinsurance_issued_txns sta  on sta.V_POLICY_TXN_TYPE_CODE =to_char(tl.transaction_type_id)\nwhere sta.v_account_number=ritxn.v_account_number and sta.fic_mis_date=ritxn.fic_mis_date)\nas cashflowColumn\nfrom stg_reinsurance_issued_txns ritxn\n)\n)stg where stg.cashflowColumn is not null",
  "CohortActuals": "select * from(select distinct to_char(stg.fic_mis_date) as as_of_date,to_char(stg.v_cohort_id) as group_id ,'1' as cf_source_type,\n'-1' as scenario_no,to_char(stg.d_transaction_date) as cash_flow_date,to_char(stg.v_txn_ccy_code) as ccy_cd,\n'3' as coverage_type,'-1' as investment_identifier,\n(select to_char(nvl(max(mls.csm_risk_type_cd),0)) from fsi_csm_risk_type_mls mls \nwhere upper(mls.csm_risk_type) = upper (stg.v_risk_expiry_status_code)) as risk_expiry_status,\n(select LISTAGG(sumamount,',') within group (order by v_policy_txn_type_code,fic_mis_date)\nfrom(select sum(COALESCE(sta.n_txn_amt_lcy,sta.n_txn_amt_ncy,sta.n_txn_amt)) as sumamount,sta.v_policy_txn_type_code,sta.fic_mis_date\nfrom stg_ins_cohort_actuals sta where to_char(sta.v_cohort_id)=to_char(stg.v_cohort_id) and to_char(sta.fic_mis_date)=to_char(stg.fic_mis_date)\nand to_char(sta.d_transaction_date)=to_char(stg.d_transaction_date)\nand to_char(sta.v_policy_txn_type_code) in(\nselect distinct to_char(tl.transaction_type_display_code)\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_b tl on attr.transaction_type_id = tl.transaction_type_id\n)group by sta.v_policy_txn_type_code,sta.fic_mis_date\n)) as amount,\n(select LISTAGG('FE_'||to_char(cash.dim_attribute_numeric_member),',') within group (order by cash.V_POLICY_TXN_TYPE_CODE)\nfrom\n(select distinct dim_attribute_numeric_member,sta.V_POLICY_TXN_TYPE_CODE\nfrom dim_transaction_type_attr attr  \njoin dim_transaction_type_b tl on attr.transaction_type_id = tl.transaction_type_id\njoin stg_ins_cohort_actuals sta  on to_char(sta.V_POLICY_TXN_TYPE_CODE) =to_char(tl.transaction_type_display_code)\nwhere sta.v_cohort_id=stg.v_cohort_id and sta.fic_mis_date=stg.fic_mis_date and sta.d_transaction_date=stg.d_transaction_date\n) cash\n)\nas cashflowColumn\nfrom stg_ins_cohort_actuals stg) where cashflowcolumn is not null ",
  "PolicyAssumed": "select * from(select distinct to_char(stg.fic_mis_date) as as_of_date,to_char(stg.v_policy_code) as policy_id,'2' as cf_source_type,\n(select to_char(nvl(max(dim.n_ins_scenario_skey),0)) from dim_insurance_scenario dim where dim.v_ins_scenario_code = stg.v_ins_scenario_code \n and dim.fic_mis_date <= stg.fic_mis_date  and dim.d_record_start_date <= stg.fic_mis_date and dim.d_record_end_date >= stg.fic_mis_date) as scenario_no,\nto_char(d_cash_flow_date) as cash_flow_date,to_char(v_cash_flow_currency_code) as ccy_cd,\n'2' as coverage_type,\n'-1' as investment_identifier,\n(select to_char(nvl(max(mls.csm_risk_type_cd),0)) from fsi_csm_risk_type_mls mls where upper(mls.csm_risk_type)=upper(stg.v_risk_expiry_status_code)) as risk_expiry_status,\n(\nselect LISTAGG(amount,',') within group (order by dim_attribute_numeric_member)\nfrom(\nselect sum(amounts) as amount,dim_attribute_numeric_member\nfrom \n(\nselect distinct coalesce(sta.n_cash_inflow_amount, sta.n_cash_outflow_amount, sta.n_ceded_amount) as amounts,attr.dim_attribute_numeric_member,\nsta.v_ins_scenario_code\nfrom dim_financial_elements_attr attr  \njoin dim_financial_elements_b tl on attr.Financial_elem_id = tl.Financial_elem_id\njoin stg_ins_policy_cash_flow sta  on sta.v_financial_element_code =tl.financial_elem_display_code \nwhere sta.v_policy_code = stg.v_policy_code and sta.d_cash_flow_date = stg.d_cash_flow_date and sta.fic_mis_date = stg.fic_mis_date\nand attr.attribute_id in(select max(tmp.attribute_id) from dim_financial_elements_attr tmp where tmp.financial_elem_id=attr.financial_elem_id)\nand sta.v_ins_scenario_code=stg.v_ins_scenario_code and sta.v_coverage_id=stg.v_coverage_id\n)cash group by cash.dim_attribute_numeric_member)\n)as amount,\n(select LISTAGG('FE_'||to_char(cashCL.dim_attribute_numeric_member),',') within group (order by cashCL.dim_attribute_numeric_member)\nfrom\n(select distinct attr.dim_attribute_numeric_member\nfrom dim_financial_elements_attr attr  \njoin dim_financial_elements_b tl on attr.Financial_elem_id = tl.Financial_elem_id\njoin stg_ins_policy_cash_flow sta  on sta.v_financial_element_code =tl.financial_elem_display_code \nwhere sta.v_policy_code = stg.v_policy_code and sta.d_cash_flow_date = stg.d_cash_flow_date and sta.fic_mis_date = stg.fic_mis_date\nand attr.attribute_id in(select max(tmp.attribute_id) from dim_financial_elements_attr tmp where tmp.financial_elem_id=attr.financial_elem_id)\nand sta.v_ins_scenario_code=stg.v_ins_scenario_code and sta.v_coverage_id=stg.v_coverage_id\n) cashCL) as cashflowColumn\nfrom stg_ins_policy_cash_flow stg\n)where cashflowcolumn is not null",
  "CohortAssumed": "select * from(select distinct to_char(stg.fic_mis_date) as as_of_date,to_char(stg.v_cohort_id) as group_id ,'2' as cf_source_type,\n'1' as scenario_no,to_char(stg.d_cash_flow_date) as cash_flow_date,to_char(stg.v_cash_flow_currency_code) as ccy_cd,\n'3' as coverage_type,'-1' as investment_identifier,(select to_char(nvl(max(mls.csm_risk_type_cd),0)) from fsi_csm_risk_type_mls mls \nwhere upper(mls.csm_risk_type) = upper (stg.v_risk_expiry_status_code)) as risk_expiry_status,\n(select LISTAGG(sumamount,',') within group (order by dim_attribute_numeric_member,V_ACTUARIAL_ASSUMPTN_CODE,V_RI_COHORT_ID)\nfrom(select sum(coalesce(sta.n_cash_inflow_amount, sta.n_cash_outflow_amount, sta.n_ceded_amount)) as sumamount,\nsta.V_ACTUARIAL_ASSUMPTN_CODE,attr.dim_attribute_numeric_member,sta.V_RI_COHORT_ID\nfrom dim_financial_elements_attr attr  \njoin dim_financial_elements_b tl on attr.FINANCIAL_ELEM_ID = tl.financial_elem_id\njoin stg_ins_cohort_assumed_cfs sta  on sta.V_FINANCIAL_ELEMENT_CODE =tl.financial_elem_display_code \nwhere sta.v_cohort_id=stg.v_cohort_id and sta.fic_mis_date=stg.fic_mis_date and sta.d_cash_flow_date=stg.d_cash_flow_date\nand attr.ATTRIBUTE_ID = (select max(temp.ATTRIBUTE_ID) from dim_financial_elements_attr temp)\ngroup by attr.dim_attribute_numeric_member,sta.V_ACTUARIAL_ASSUMPTN_CODE,sta.V_RI_COHORT_ID \n)) as amount,\n(select LISTAGG('FE_'||to_char(cash.dim_attribute_numeric_member),',') within group (order by cash.dim_attribute_numeric_member,V_ACTUARIAL_ASSUMPTN_CODE,V_RI_COHORT_ID)\nfrom\n(select distinct dim_attribute_numeric_member,sta.fic_mis_date,sta.V_ACTUARIAL_ASSUMPTN_CODE,sta.V_RI_COHORT_ID\nfrom dim_financial_elements_attr attr  \njoin dim_financial_elements_b tl on attr.FINANCIAL_ELEM_ID = tl.financial_elem_id\njoin stg_ins_cohort_assumed_cfs sta  on sta.V_FINANCIAL_ELEMENT_CODE =tl.financial_elem_display_code\nwhere sta.v_cohort_id=stg.v_cohort_id and sta.fic_mis_date=stg.fic_mis_date and sta.d_cash_flow_date=stg.d_cash_flow_date\nand attr.ATTRIBUTE_ID = (select max(temp.ATTRIBUTE_ID) from dim_financial_elements_attr temp)\n) cash\n)\nas cashflowColumn\n\nfrom stg_ins_cohort_assumed_cfs stg) where cashflowColumn is not null order by group_id,as_of_date",
  "Test_Data_Validation": "select * from(\n(select sl.v_account_number as policy_id,(sl.fic_mis_date) as as_of_date,(sl.d_transaction_date) as CASH_FLOW_DATE,\nsl.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sl.v_coverage_id\nand dim.d_record_start_date <= sl.fic_mis_date and dim.d_record_end_date >= sl.fic_mis_date) as coverage_type,\nCOALESCE(sl.n_txn_amt_lcy,sl.n_txn_amt_ncy,sl.n_txn_amt) as amount,sl.v_policy_txn_type_code as cash_flow\nfrom Stg_Life_Ins_Policy_Txns sl)\nunion\n(select he.v_account_number as policy_id,(he.fic_mis_date) as as_of_date,(he.d_transaction_date) as CASH_FLOW_DATE,\nhe.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=he.v_coverage_id\nand dim.d_record_start_date <= he.fic_mis_date and dim.d_record_end_date >= he.fic_mis_date) as coverage_type,\nCOALESCE(he.n_txn_amt_lcy,he.n_txn_amt_ncy,he.n_txn_amt) as amount,\nhe.V_POLICY_TXN_TYPE_CODE as cashflowColumn\nfrom stg_health_ins_policy_txns he)\nunion\n(select sp.v_account_number as policy_id,(sp.fic_mis_date) as as_of_date,(sp.d_transaction_date) as CASH_FLOW_DATE,\nsp.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sp.v_coverage_id\nand dim.d_record_start_date <= sp.fic_mis_date and dim.d_record_end_date >= sp.fic_mis_date) as coverage_type,\nCOALESCE(sp.n_txn_amt_lcy,sp.n_txn_amt_ncy,sp.n_txn_amt) as amount,sp.V_POLICY_TXN_TYPE_CODE as cashflowColumn\nfrom stg_prop_casu_policy_txns sp)\nunion\n(\nselect sa.v_account_number as policy_id,(sa.fic_mis_date) as as_of_date,(sa.d_transaction_date) as CASH_FLOW_DATE,\nsa.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sa.v_coverage_id\nand dim.d_record_start_date <= sa.fic_mis_date and dim.d_record_end_date >= sa.fic_mis_date) as coverage_type,\nCOALESCE(sa.n_txn_amt_lcy,sa.n_txn_amt_ncy,sa.n_txn_amt) as amount,\nsa.V_POLICY_TXN_TYPE_CODE as cashflowColumn\nfrom stg_annuity_txns sa\n)\nunion\n(\nselect sr.v_account_number as policy_id,(sr.fic_mis_date) as as_of_date,(sr.d_txn_date) as CASH_FLOW_DATE,\nsr.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=sr.v_coverage_id and dim.d_record_start_date <= sr.fic_mis_date\nand dim.d_record_end_date >= sr.fic_mis_date) as coverage_type,\nCOALESCE(sr.n_txn_amt_lcy,sr.n_txn_amt_ncy,sr.n_txn_amt) as amount,\nsr.V_POLICY_TXN_TYPE_CODE as cashflowColumn\nfrom stg_retirement_accounts_txns sr\n)\nunion\n(\nselect cl.v_policy_id as policy_id,(cl.fic_mis_date) as as_of_date,(COALESCE(cl.d_claim_closed_date,cl.d_claim_reclosed_date)) as CASH_FLOW_DATE,\ncl.v_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=cl.v_coverage_id\nand dim.d_record_start_date <= cl.fic_mis_date and dim.d_record_end_date >= cl.fic_mis_date) as coverage_type,\nCOALESCE(cl.n_tot_settled_amount, cl.n_claim_amount_outstanding) as amount,cl.v_claim_type as cashflowColumn\nfrom stg_claim_details cl \n)\nunion\n(\nselect ritxn.v_account_number as policy_id,(ritxn.fic_mis_date) as as_of_date,(ritxn.d_transaction_date) as CASH_FLOW_DATE,\nritxn.v_txn_ccy_code as ccy_cd,(select nvl(max(dim.n_coverage_type_skey),0) from dim_coverage_type dim,stg_policy_coverages stg where \ndim.v_coverage_type=stg.V_COVERAGE_TYPE and stg.v_coverage_id=ritxn.v_coverage_id and dim.d_record_start_date <= ritxn.fic_mis_date\nand dim.d_record_end_date >= ritxn.fic_mis_date) as coverage_type,\nCOALESCE(ritxn.n_txn_amt_ncy,ritxn.n_txn_amt) as amount,\nritxn.V_POLICY_TXN_TYPE_CODE\nas cashflowColumn\nfrom stg_reinsurance_issued_txns ritxn\n)\n)\n"
}